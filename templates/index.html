<!-- FILE: templates/index.html -->
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Link Processor</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <!-- Custom Styles -->
    <style>
        :root { --pico-primary: #334e99; --pico-primary-hover: #263a73; --pico-primary-focus: rgba(51, 78, 153, 0.25); --pico-primary-inverse: #fff; }
        .container { max-width: 960px; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; margin-bottom: 2rem; }
        .navbar-brand { display: flex; align-items: center; gap: 1rem; font-weight: bold; font-size: 1.2rem; }
        .navbar-brand img { height: 40px; }
        #theme-toggle { display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; padding: 0; }
        .form-box { text-align: center; }
        input[type="file"] { display: none; }
        .file-upload-wrapper { border: 2px dashed var(--pico-form-element-border-color); padding: 2rem; text-align: center; cursor: pointer; margin-bottom: 1rem; transition: border-color 0.2s; }
        .file-upload-wrapper:hover { border-color: var(--pico-primary); }
        #filename-display { margin-top: 1rem; font-style: italic; color: var(--pico-muted-color); }
        .grid { grid-template-columns: 1fr 1fr; }
        .instructions { margin-top: 4rem; text-align: left; }
        .instructions-grid { display: grid; gap: 2rem; margin-top: 2rem; grid-template-columns: repeat(2, 1fr); }
        .instructions-grid .material-symbols-outlined { font-size: 48px; color: var(--pico-primary); }
        @media (max-width: 768px) { .instructions-grid { grid-template-columns: 1fr; } .grid { grid-template-columns: 1fr; } }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <nav class="navbar">
                <div class="navbar-brand"><img src="/static/logo.png" alt="App Logo"><span>PDF Link Processor</span></div>
                <button id="theme-toggle" class="secondary outline"><span class="material-symbols-outlined">light_mode</span></button>
            </nav>
        </header>

        <main>
            <article class="form-box">
                <header><h2>Analyze PDF Links Fast and Easy</h2></header>
                <form action="/process" method="post" enctype="multipart/form-data">
                    <label for="pdf_file_input" class="file-upload-wrapper">
                        <span role="button">Choose PDF File(s)</span>
                        <div id="filename-display">No files selected</div>
                    </label>
                    <!-- Added 'multiple' to allow batch uploads -->
                    <input type="file" name="pdf_file" id="pdf_file_input" required multiple>
                    
                    <div class="grid">
                        <label for="keywords">
                            Keywords for Invalid Links
                            <textarea name="keywords" id="keywords" rows="4">please call bass tool
no items found that match</textarea>
                        </label>
                        <label for="highlight_color">
                            Highlight Color
                            <select id="highlight_color" name="highlight_color">
                                <option value="Yellow" selected>Yellow</option>
                                <option value="Pink">Pink</option>
                                <option value="Green">Green</option>
                                <option value="Blue">Blue</option>
                            </select>
                        </label>
                    </div>
                    
                    <fieldset><legend><strong>Select Your Outputs</strong></legend>
                        <label><input type="checkbox" name="outputs" value="excel" checked> Link Status Report (Excel)</label>
                        <label><input type="checkbox" name="outputs" value="highlighted" checked> Highlighted PDF</label>
                        <label><input type="checkbox" name="outputs" value="extracted"> Extracted Pages</label>
                        <label><input type="checkbox" name="outputs" value="sorted"> Extracted & Sorted Pages</label>
                    </fieldset>
                    
                    <button type="submit">Start Processing â†’</button>
                </form>
            </article>

            <!-- Results will be displayed here -->
            <section id="results-section" style="display:none; margin-top: 2rem;">
                <hr>
                <h3>Processing Results</h3>
                <article id="results-container"></article>
            </section>
            
            <section class="instructions"><hr><h2>How It Works & What You Get</h2>
                <div class="instructions-grid">
                    <article><span class="material-symbols-outlined">description</span><h3>Link Status Report (Excel)</h3><p>Generates a spreadsheet of every link found, its page number, HTTP status, and validity.</p></article>
                    <article><span class="material-symbols-outlined">highlight</span><h3>Highlighted PDF</h3><p>Creates a copy of your PDF with every invalid link highlighted in your chosen color.</p></article>
                    <article><span class="material-symbols-outlined">filter_list</span><h3>Extracted Pages</h3><p>Produces a new PDF containing only the pages that have one or more highlights.</p></article>
                    <article><span class="material-symbols-outlined">sort</span><h3>Extracted & Sorted Pages</h3><p>Extracts pages with invalid links and sorts them by the number of highlights, most to least.</p></article>
                </div>
            </section>
        </main>
    </div>

    <!-- jQuery and DataTables for the interactive table -->
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = themeToggle.querySelector('.material-symbols-outlined');
        const htmlElement = document.documentElement;
        function setTheme(theme) { htmlElement.setAttribute('data-theme', theme); themeIcon.textContent = theme === 'dark' ? 'light_mode' : 'dark_mode'; localStorage.setItem('theme', theme); }
        themeToggle.addEventListener('click', () => { const currentTheme = htmlElement.getAttribute('data-theme'); setTheme(currentTheme === 'dark' ? 'light' : 'dark'); });
        const savedTheme = localStorage.getItem('theme') || 'light'; setTheme(savedTheme);

        const fileInput = document.getElementById('pdf_file_input');
        const filenameDisplay = document.getElementById('filename-display');
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 1) { filenameDisplay.textContent = `${fileInput.files.length} files selected`; } 
            else if (fileInput.files.length === 1) { filenameDisplay.textContent = fileInput.files[0].name; } 
            else { filenameDisplay.textContent = 'No files selected'; }
        });

        // This script will handle the form submission with real-time updates
        $('form').on('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const resultsSection = $('#results-section');
            const resultsContainer = $('#results-container');
            
            resultsContainer.html('<progress></progress><p>Uploading files and starting process...</p>');
            resultsSection.show();

            $.ajax({
                url: '/process',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(data) {
                    resultsContainer.html(data); // The server will send back the final HTML
                },
                error: function() {
                    resultsContainer.html('<article><p>An error occurred. Please try again.</p></article>');
                }
            });
        });
    </script>
</body>
</html>